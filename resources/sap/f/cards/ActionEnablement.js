/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/Log","sap/f/cards/BindingResolver"],function(e,t,a){"use strict";var i={};function n(e,t){if(!e.actions){return}var a=e.actions[0];if(a.type==="Navigation"){this._attachNavigationAction(e,t||this)}}function r(t){var i=this;var n=e.bindingParser("{path:''}");n.formatter=function(e){var n=this.getBindingContext(),r=this.getModel(),s;if(n){s=n.getPath()}var o=a.resolveValue(t.parameters,r,s);if(e.__resolved){if(e.__enabled){return"Navigation"}else{return"Inactive"}}if(!e.__promise){e.__promise=true;i._oServiceManager.getService("sap.ui.integration.services.Navigation").then(function(t){if(t){t.enabled({parameters:o}).then(function(t){e.__resolved=true;e.__enabled=t;i.getModel().checkUpdate(true)}).catch(function(){e.__resolved=true;e.__enabled=false})}else{e.__resolved=true;e.__enabled=false}})}return"Inactive"};this._oItemTemplate.bindProperty("type",n)}function s(e){var t=e.actions[0],i=this.getBindingContext(),n=t.parameters,r=this.getModel(),s;if(i){s=i.getPath()}n=a.resolveValue(t.parameters,r,s);return new Promise(function(e){this._oServiceManager.getService("sap.ui.integration.services.Navigation").then(function(t){if(t){t.enabled({parameters:n}).then(function(t){e(t)}).catch(function(){e(false)})}else{e(false)}}).catch(function(){e(false)})}.bind(this))}function o(t){var a;if(typeof t.enabled==="string"){a=e.bindingParser(t.enabled);a.formatter=function(e){if(e&&typeof e==="string"){return"Navigation"}else{return"Inactive"}}}if(a){this._oItemTemplate.bindProperty("type",a)}else{var i=t.enabled!==false?true:false;var n=i?"Navigation":"Inactive";this._oItemTemplate.setProperty("type",n)}}function c(){this.addStyleClass("sapFCardHeaderClickable")}function l(e,t,i,n){this.fireEvent("action",{type:"Navigation",actionSource:e,manifestParameters:a.resolveValue(t,i,n)})}function f(e,i){var n=e.actions[0];var r;var s=true;var o=function(){i.attachPress(r.bind(this));if(this._addHeaderClasses){this._addHeaderClasses()}}.bind(this);if(n.service){if(this._setItemTypeFormatter){this._setItemTypeFormatter(n)}r=function(e){var i=e.getSource(),r=i.getBindingContext(),s=i.getModel(),o;if(r){o=r.getPath()}this._oServiceManager.getService("sap.ui.integration.services.Navigation").then(function(e){if(e){e.navigate({parameters:a.resolveValue(n.parameters,s,o)})}}).catch(function(e){t.error("Navigation service unavailable",e)});l.call(this,e.getSource(),n.parameters,s,o)};s=false}else{if(this._setActionEnabledState){this._setActionEnabledState(n);s=false}if(n.url){r=function(e){var t=e.getSource(),i=t.getBindingContext(),r=t.getModel(),s,o;if(i){s=i.getPath()}o=a.resolveValue(n.url,r,s);window.open(o,n.target||"_blank");l.call(this,e.getSource(),n.parameters,r,s)}}else{r=function(e){var t=e.getSource(),a=t.getBindingContext(),i=t.getModel(),r;if(a){r=a.getPath()}l.call(this,e.getSource(),n.parameters,i,r)}}}if(i.isA("sap.f.cards.IHeader")&&n.service){this._setHeaderActionEnabledState(e).then(function(e){if(e){o()}});return}else{if(s){if(n.enabled!==false){o()}}else{o()}}}i.enrich=function(e){e.prototype._attachActions=n;e.prototype._attachNavigationAction=f;if(e.prototype.isA("sap.f.cards.ListContent")||e.prototype.isA("sap.f.cards.TableContent")){e.prototype._setItemTypeFormatter=r;e.prototype._setActionEnabledState=o}if(e.prototype.isA("sap.f.cards.IHeader")){e.prototype._addHeaderClasses=c;e.prototype._setHeaderActionEnabledState=s}};return i});