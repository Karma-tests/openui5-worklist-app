/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/f/cards/Data","sap/base/Log"],function(t,e,a,i){"use strict";var n=t.extend("sap.f.cards.BaseContent",{metadata:{properties:{configuration:{type:"object"}},aggregations:{_content:{multiple:false,visibility:"hidden"}}},constructor:function(e,a){if(typeof e!=="string"){a=e}if(a&&a.serviceManager){this._oServiceManager=a.serviceManager;delete a.serviceManager}t.apply(this,arguments)},renderer:function(t,e){var a="sapFCard";var i=e.getMetadata().getLibraryName();var r=e.getMetadata().getName();var s=r.slice(i.length+1,r.length);var o=n.getMinHeight(s,e.getConfiguration());a+=s;t.write("<div");t.writeElementData(e);t.addClass(a);t.addClass("sapFCardBaseContent");t.writeClasses();t.addStyle("min-height",o);t.writeStyles();t.write(">");t.renderControl(e.getAggregation("_content"));t.write("</div>")}});n.prototype.init=function(){var t=new e;this.setModel(t)};n.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);if(this._dataChangeHandler&&this._oDataService){this._oDataService.detachDataChanged(this._dataChangeHandler);this._dataChangeHandler=null;this._oDataService=null}return t.prototype.destroy.apply(this,arguments)};n.prototype.setConfiguration=function(t){this.setProperty("configuration",t);if(!t){return this}if(t.data){this._setData(t.data)}if(t.maxItems){this.getModel().setSizeLimit(t.maxItems)}return this};n.prototype._setData=function(t){this.setBusy(true);var e=t.request;var i=t.service;this.bindElement({path:t.path||"/"});if(t.json&&!e){this._updateModel(t.json);this.setBusy(false)}if(i){this._oServiceManager.getService("sap.ui.integration.services.Data").then(function(e){if(e){this._dataChangeHandler=function(t){this._updateModel(t.data)}.bind(this);e.getData().then(function(t){this._updateModel(t)}.bind(this)).catch(function(){this._handleError("Card content data service failed to get data")}).finally(function(){this.setBusy(false)}.bind(this));e.attachDataChanged(this._dataChangeHandler,t.service.parameters);this._oDataService=e}}.bind(this)).catch(function(){this._handleError("Data service unavailable");this.setBusy(false)})}else if(e){a.fetch(e).then(function(e){this._updateModel(e,t.path)}.bind(this)).catch(function(t){this._handleError("Card content data request failed")}).finally(function(){this.setBusy(false)}.bind(this))}};n.prototype._updateModel=function(t){this.getModel().setData(t);setTimeout(function(){this.fireEvent("_updated")}.bind(this),0)};n.prototype._handleError=function(t){this.fireEvent("_error",{logMessage:t})};n.getMinHeight=function(t,e){var a=5,i;if(jQuery.isEmptyObject(e)){return"0rem"}switch(t){case"ListContent":i=n._getMinListHeight(e);break;case"TableContent":i=n._getMinTableHeight(e);break;case"TimelineContent":i=n._getMinTimelineHeight(e);break;case"AnalyticalContent":i=14;break;case"ObjectContent":i=0;break;default:i=0}return(i!==0?i:a)+"rem"};n._getMinListHeight=function(t){var e=t.maxItems||0,a=t.item,i=3;if(!a){return 0}if(a.icon||a.description){i=4}return e*i};n._getMinTableHeight=function(t){var e=t.maxItems||0,a=3,i=3;return e*a+i};n._getMinTimelineHeight=function(t){var e=t.maxItems||0,a=6;return e*a};return n});