/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/OverflowToolbarLayoutData","sap/ui/Device","sap/ui/core/theming/Parameters","sap/m/library"],function(t,e,i,o){"use strict";var n=o.OverflowToolbarPriority;var a;var s=function(t){a=t;this._iREMSize=parseInt(jQuery("body").css("font-size"));this._iChildControlMargin=parseInt(i.get("_sap_f_ShellBar_ChildMargin"));this._iDoubleChildControlMargin=this._iChildControlMargin*2;this._iCoPilotWidth=parseInt(i.get("_sap_f_ShellBar_CoPilotWidth"))+this._iDoubleChildControlMargin;this._iHalfCoPilotWidth=this._iCoPilotWidth/2;this._oDelegate={onAfterRendering:this.onAfterRendering,onBeforeRendering:this.onBeforeRendering};a.addDelegate(this._oDelegate,false,this);this._fnResize=this._resize;a._oOverflowToolbar.attachEvent("_controlWidthChanged",this._handleResize,this)};s.prototype.onAfterRendering=function(){this._oDomRef=a.getDomRef();if(a._oMegaMenu){this._oButton=a._oMegaMenu.getAggregation("_button");if(this._oButton&&this._oButton._image){this._oButton._image.attachEvent("load",this._updateMegaMenuWidth,this)}}this._initResize();this._handleResize()};s.prototype.onBeforeRendering=function(){if(a._oHomeIcon){a._oHomeIcon.attachEvent("load",this._updateHomeIconWidth,this)}};s.prototype.exit=function(){if(a._oOverflowToolbar){a._oOverflowToolbar.detachEvent("_controlWidthChanged",this._handleResize,this)}if(a._oHomeIcon){a._oHomeIcon.detachEvent("load",this._updateHomeIconWidth,this)}if(this._oButton){this._oButton.detachEvent("load",this._updateMegaMenuWidth,this)}a.removeDelegate(this._oDelegate)};s.prototype._initResize=function(){this._iStaticWidth=0;this._iMBWidth=this.getTargetWidth(a._oMegaMenu)+65+2*this._iChildControlMargin;this._iTitleWidth=this.getTargetWidth(a._oSecondTitle);if(a._oHomeIcon){this._iStaticWidth+=a._oHomeIcon.$().outerWidth(true)}if(a._oNavButton){this._iStaticWidth+=36+this._iDoubleChildControlMargin}if(a._oMenuButton){this._iStaticWidth+=36+this._iDoubleChildControlMargin}};s.prototype._updateHomeIconWidth=function(){this._initResize();this._fnResize()};s.prototype._updateMegaMenuWidth=function(){this._initResize();this._fnResize()};s.prototype._handleResize=function(){if(!this._oDomRef){return}var t=a.$(),i=t.outerWidth(),o=e.media.getCurrentRange("Std",i),n;if(o){n=o.name==="Phone";t.toggleClass("sapFShellBarSizeDesktop",o.name==="Desktop");t.toggleClass("sapFShellBarSizeTablet",o.name==="Tablet");t.toggleClass("sapFShellBarSizePhone",n)}if(this._iPreviousWidth===i){return}this._iPreviousWidth=i;if(!a._oNavButton&&!a._oMenuButton&&!a._oHomeIcon&&!a._oMegaMenu&&!a._oSecondTitle&&!a._oCopilot){return}if(n&&!this.bWasInPhoneRange){this._fnResize=this._resizeOnPhone;this._transformToPhoneState();return}else if(!n&&this.bWasInPhoneRange){this._fnResize=this._resize;this._transformToRegularState();return}setTimeout(this._fnResize.bind(this),0)};s.prototype._transformToPhoneState=function(){if(a._oSecondTitle){a._oSecondTitle.setVisible(false)}if(a._oHomeIcon){a._oHomeIcon.setVisible(false);if(a._oMegaMenu){a._oMegaMenu.setWidth("auto").setText("").setIcon(a.getHomeIcon())}}this._cacheControlsLayoutData();a._aOverflowControls.forEach(function(e){e.setLayoutData(new t({priority:n.AlwaysOverflow}))});this.bWasInPhoneRange=true;a.invalidate()};s.prototype._transformToRegularState=function(){if(a._oSecondTitle){a._oSecondTitle.setVisible(true)}if(a._oHomeIcon){a._oHomeIcon.setVisible(true);if(a._oMegaMenu){a._oMegaMenu.setWidth("auto").setText(a._sTitle).setIcon("")}}this._restoreControlsLayoutData();this.bWasInPhoneRange=false;a.invalidate()};s.prototype._resizeOnPhone=function(){var t,e;if(a._oCopilot){t=a.$().width()-this._iCoPilotWidth;e=t/2-this._iStaticWidth}else{t=a.$().width();e=t-this._iStaticWidth-this._getWidthOfAllNonManagedControls()}if(!a._oHomeIcon&&a._sTitle){if(this._iMBWidth>=e){a._oMegaMenu.setWidth(e-this._iDoubleChildControlMargin+"px")}else{a._oMegaMenu.setWidth(this._iMBWidth-this._iDoubleChildControlMargin+"px")}}if(a._oMegaMenu){e-=a._oMegaMenu.$().outerWidth(true)}if(e<0){e=0}a._oControlSpacer.setWidth(e+"px")};s.prototype._resize=function(){var t=a.$().width(),e,i;if(!a._oCopilot){i=this._getWidthOfAllNonManagedControls();e=t-i-this._iStaticWidth-8*this._iREMSize;this._adaptManagedWidthControls(e);return}e=t/2-this._iHalfCoPilotWidth-this._iStaticWidth;this._adaptManagedWidthControls(e)};s.prototype._getWidthOfAllNonManagedControls=function(){var t=a._oOverflowToolbar.$().children(),e=0;t.filter(function(t,i){var o=jQuery(i),n=o.control(0);if(n===a._oNavButton){return false}if(n===a._oMenuButton){return false}if(n===a._oHomeIcon){return false}if(n===a._oMegaMenu){return false}if(n===a._oSecondTitle){return false}if(n===a._oControlSpacer){return false}if(n===a._oToolbarSpacer){return false}e+=o.outerWidth(true);return true});return e};s.prototype._adaptManagedWidthControls=function(t){var e=a._sTitle,i=e?this._iMBWidth:36+this._iDoubleChildControlMargin,o=this._iTitleWidth,n=i+o,s=a._oSecondTitle,r=a._oMegaMenu,h=a._oControlSpacer,l;if(!r){n-=36+this._iDoubleChildControlMargin}if(n<0){n=0}if(i<0){i=0}if(i>=t){h&&h.setWidth("0px");s&&s.setWidth("0px");e&&r.setWidth(t-this._iDoubleChildControlMargin+"px");return}else{e&&r.setWidth(i-this._iDoubleChildControlMargin+"px")}if(t>=i&&t<=n){l=t-i;if(l<0){l=0}if(l>32){h&&h.setWidth("0px");s&&s.setWidth(l+"px")}else{h&&h.setWidth(l+"px");s&&s.setWidth("0px")}return}else{s&&s.setWidth(o+"px")}if(t>n){h&&h.setWidth(t-n+"px")}};s.prototype._cacheControlsLayoutData=function(){this._oCachedLayoutData={};a._aOverflowControls.forEach(function(t){this._oCachedLayoutData[t.getId()]=t.getLayoutData()}.bind(this))};s.prototype._restoreControlsLayoutData=function(){a._aOverflowControls.forEach(function(t){var e=this._oCachedLayoutData[t.getId()];if(e){t.setLayoutData(e)}}.bind(this))};s.prototype.getTargetWidth=function(t,e){if(!t){return 0}var i=t.getText(),o=document.createElement("div"),n=document.createTextNode(i),a=sap.ui.getCore().getStaticAreaRef(),s;o.appendChild(n);o.style.setProperty("white-space","nowrap");o.style.setProperty("display","inline-block");o.style.setProperty("font-size","0.875rem");if(e){o.style.setProperty("font-weight","bold")}a.appendChild(o);s=o.scrollWidth;a.removeChild(o);return s};return s});