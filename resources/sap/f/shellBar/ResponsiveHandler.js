/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/OverflowToolbarLayoutData","sap/m/OverflowToolbarPriority","sap/ui/Device","sap/ui/core/theming/Parameters"],function(t,e,i,o){"use strict";var n;var a=function(t){n=t;this._iREMSize=parseInt(jQuery("body").css("font-size"));this._iChildControlMargin=parseInt(o.get("_sap_f_ShellBar_ChildMargin"));this._iDoubleChildControlMargin=this._iChildControlMargin*2;this._iCoPilotWidth=parseInt(o.get("_sap_f_ShellBar_CoPilotWidth"))+this._iDoubleChildControlMargin;this._iHalfCoPilotWidth=this._iCoPilotWidth/2;this._oDelegate={onAfterRendering:this.onAfterRendering,onBeforeRendering:this.onBeforeRendering};n.addDelegate(this._oDelegate,false,this);this._fnResize=this._resize;n._oOverflowToolbar.attachEvent("_controlWidthChanged",this._handleResize,this)};a.prototype.onAfterRendering=function(){this._oDomRef=n.getDomRef();if(n._oMegaMenu){var t=n._oMegaMenu.getAggregation("_button");if(t&&t._image){t._image.attachEvent("load",this._updateMegaMenuWidth,this)}}this._initResize();this._handleResize()};a.prototype.onBeforeRendering=function(){if(n._oHomeIcon){n._oHomeIcon.attachEvent("load",this._updateHomeIconWidth,this)}};a.prototype.exit=function(){if(n._oOverflowToolbar){n._oOverflowToolbar.detachEvent("_controlWidthChanged",this._handleResize,this)}if(n._oHomeIcon){n._oHomeIcon.detachEvent("load",this._updateHomeIconWidth,this)}n.removeDelegate(this._oDelegate)};a.prototype._initResize=function(){this._iStaticWidth=0;this._iMBWidth=this.getTargetWidth(n._oMegaMenu)+65+2*this._iChildControlMargin;this._iTitleWidth=this.getTargetWidth(n._oSecondTitle);if(n._oHomeIcon){this._iStaticWidth+=n._oHomeIcon.$().outerWidth(true)}if(n._oNavButton){this._iStaticWidth+=36+this._iDoubleChildControlMargin}if(n._oMenuButton){this._iStaticWidth+=36+this._iDoubleChildControlMargin}};a.prototype._updateHomeIconWidth=function(){this._initResize();this._fnResize()};a.prototype._updateMegaMenuWidth=function(){this._initResize();this._fnResize()};a.prototype._handleResize=function(){if(!this._oDomRef){return}var t=n.$(),e=t.outerWidth(),o=i.media.getCurrentRange("Std",e),a;if(o){a=o.name==="Phone";t.toggleClass("sapFShellBarSizeDesktop",o.name==="Desktop");t.toggleClass("sapFShellBarSizeTablet",o.name==="Tablet");t.toggleClass("sapFShellBarSizePhone",a)}if(this._iPreviousWidth===e){return}this._iPreviousWidth=e;if(!n._oNavButton&&!n._oMenuButton&&!n._oHomeIcon&&!n._oMegaMenu&&!n._oSecondTitle&&!n._oCopilot){return}if(a&&!this.bWasInPhoneRange){this._fnResize=this._resizeOnPhone;this._transformToPhoneState();return}else if(!a&&this.bWasInPhoneRange){this._fnResize=this._resize;this._transformToRegularState();return}setTimeout(this._fnResize.bind(this),0)};a.prototype._transformToPhoneState=function(){if(n._oSecondTitle){n._oSecondTitle.setVisible(false)}if(n._oHomeIcon){n._oHomeIcon.setVisible(false);if(n._oMegaMenu){n._oMegaMenu.setWidth("auto").setText("").setIcon(n.getHomeIcon())}}this._cacheControlsLayoutData();n._aOverflowControls.forEach(function(t){t.setLayoutData(new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.AlwaysOverflow}))});this.bWasInPhoneRange=true;n.invalidate()};a.prototype._transformToRegularState=function(){if(n._oSecondTitle){n._oSecondTitle.setVisible(true)}if(n._oHomeIcon){n._oHomeIcon.setVisible(true);if(n._oMegaMenu){n._oMegaMenu.setWidth("auto").setText(n._sTitle).setIcon("")}}this._restoreControlsLayoutData();this.bWasInPhoneRange=false;n.invalidate()};a.prototype._resizeOnPhone=function(){var t,e;if(n._oCopilot){t=n.$().width()-this._iCoPilotWidth;e=t/2-this._iStaticWidth}else{t=n.$().width();e=t-this._iStaticWidth-this._getWidthOfAllNonManagedControls()}if(!n._oHomeIcon&&n._sTitle){if(this._iMBWidth>=e){n._oMegaMenu.setWidth(e-this._iDoubleChildControlMargin+"px")}else{n._oMegaMenu.setWidth(this._iMBWidth-this._iDoubleChildControlMargin+"px")}}if(n._oMegaMenu){e-=n._oMegaMenu.$().outerWidth(true)}if(e<0){e=0}n._oControlSpacer.setWidth(e+"px")};a.prototype._resize=function(){var t=n.$().width(),e,i;if(!n._oCopilot){i=this._getWidthOfAllNonManagedControls();e=t-i-this._iStaticWidth-8*this._iREMSize;this._adaptManagedWidthControls(e);return}e=t/2-this._iHalfCoPilotWidth-this._iStaticWidth;this._adaptManagedWidthControls(e)};a.prototype._getWidthOfAllNonManagedControls=function(){var t=n._oOverflowToolbar.$().children(),e=0;t.filter(function(t,i){var o=jQuery(i),a=o.control(0);if(a===n._oNavButton){return false}if(a===n._oMenuButton){return false}if(a===n._oHomeIcon){return false}if(a===n._oMegaMenu){return false}if(a===n._oSecondTitle){return false}if(a===n._oControlSpacer){return false}if(a===n._oToolbarSpacer){return false}e+=o.outerWidth(true);return true});return e};a.prototype._adaptManagedWidthControls=function(t){var e=n._sTitle,i=e?this._iMBWidth:36+this._iDoubleChildControlMargin,o=this._iTitleWidth,a=i+o,r=n._oSecondTitle,s=n._oMegaMenu,h=n._oControlSpacer,l;if(!s){a-=36+this._iDoubleChildControlMargin}if(a<0){a=0}if(i<0){i=0}if(i>=t){h&&h.setWidth("0px");r&&r.setWidth("0px");e&&s.setWidth(t-this._iDoubleChildControlMargin+"px");return}else{e&&s.setWidth(i-this._iDoubleChildControlMargin+"px")}if(t>=i&&t<=a){l=t-i;if(l<0){l=0}if(l>32){h&&h.setWidth("0px");r&&r.setWidth(l+"px")}else{h&&h.setWidth(l+"px");r&&r.setWidth("0px")}return}else{r&&r.setWidth(o+"px")}if(t>a){h&&h.setWidth(t-a+"px")}};a.prototype._cacheControlsLayoutData=function(){this._oCachedLayoutData={};n._aOverflowControls.forEach(function(t){this._oCachedLayoutData[t.getId()]=t.getLayoutData()}.bind(this))};a.prototype._restoreControlsLayoutData=function(){n._aOverflowControls.forEach(function(t){t.setLayoutData(this._oCachedLayoutData[t.getId()])}.bind(this))};a.prototype.getTargetWidth=function(t,e){if(!t){return 0}var i=t.getText(),o=document.createElement("div"),n=document.createTextNode(i),a=sap.ui.getCore().getStaticAreaRef(),r;o.appendChild(n);o.style.setProperty("white-space","nowrap");o.style.setProperty("display","inline-block");o.style.setProperty("font-size","0.875rem");if(e){o.style.setProperty("font-weight","bold")}a.appendChild(o);r=o.scrollWidth;a.removeChild(o);return r};return a});